#Icon Combobox 
#Author: Mike Morley (mmorely19@gmail.com)
from gi.repository import Gtk, GdkPixbuf

class HeaderedComboBox(Gtk.Window):

    def __init__(self):
        Gtk.Window.__init__(self, title="ComboBox Example")

        self.set_border_width(10)

	folderpb = Gtk.IconTheme.get_default().load_icon('folder', 16, Gtk.IconLookupFlags.FORCE_SIZE)	

        name_store = Gtk.ListStore(int, str, GdkPixbuf.Pixbuf)
        name_store.append([1, "<b>Folders</b>", None])
        name_store.append([0, "Home", folderpb])
        name_store.append([0, "Media", folderpb])
        name_store.append([1, "<b>Library</b>", None])
        name_store.append([0, "Music", folderpb])

        vbox = Gtk.Box(orientation=Gtk.Orientation.VERTICAL, spacing=6)

        name_combo = Gtk.ComboBox.new_with_model(name_store)
        name_combo.connect("changed", self.on_name_combo_changed)

	renderertext = Gtk.CellRendererText()
	name_combo.pack_end(renderertext, True)
	name_combo.add_attribute(renderertext, "markup", 1) # use renderertext with "text" from name_store model data at 1

	rendererpb = Gtk.CellRendererPixbuf()
	name_combo.pack_start(rendererpb, True)
	name_combo.add_attribute(rendererpb, "pixbuf", 2) # use rendererpb with a "pixbuf" from name_store model data at 2

        name_combo.set_entry_text_column(1)
        vbox.pack_start(name_combo, False, False, 0)       

        self.add(vbox)

    def on_name_combo_changed(self, combo):
        tree_iter = combo.get_active_iter()
        if tree_iter != None:
            model = combo.get_model()
            row_id, name = model[tree_iter][:2]
            #print "Selected: ID=%d, name=%s" % (row_id, name)
	    if row_id == 1:
		print "zomg its a header!"
		combo.set_active_iter(model.iter_next(tree_iter)) # if they try and select a header move to the real entry below insteads
        else:
            entry = combo.get_child()
            print "Entered: %s" % entry.get_text()


#testing and debugging bits
win = HeaderedComboBox()
win.connect("delete-event", Gtk.main_quit)
win.show_all()
Gtk.main()
